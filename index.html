<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TaskVanta Dashboard</title>

<!-- PWA manifest -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#22c55e">

<style>
  body { font-family: Arial; background:#0f172a; color:#fff; margin:0; }
  header { padding:20px; background:#020617; text-align:center; font-size:1.5em; }
  .card { background:#020617; margin:16px auto; padding:20px; border-radius:12px; width:90%; max-width:400px; box-shadow:0 4px 8px rgba(0,0,0,0.2); }
  button { padding:10px 14px; border:none; border-radius:8px; background:#22c55e; cursor:pointer; margin-top:10px; width:100%; font-size:1em; }
  a { color:#22c55e; text-decoration:none; display:block; margin:10px 0; text-align:center; font-weight:bold; }
  #installBtn { background:#f59e0b; }
</style>
</head>
<body>

<header>TaskVanta Dashboard</header>

<div class="card">
  <p><b>User:</b> <span id="user"></span></p>
  <p><b>Balance:</b> ₦<span id="bal">0</span></p>
  <button onclick="logout()">Logout</button>
  <button id="installBtn">Install App</button>
</div>

<div class="card">
  <a href="tasks.html">Go to Tasks</a>
  <a href="withdraw.html">Withdraw</a>
  <a href="referral.html">Referrals</a>
  <a href="admin.html">Admin Panel</a>
</div>

<script>
  // ✅ Login check
  const user = localStorage.getItem('tv_user');
  if(!user){
    alert("You must login first!");
    window.location.href = "login.html";
  }

  // Show user and balance
  document.getElementById('user').textContent = user;
  document.getElementById('bal').textContent = localStorage.getItem('tv_bal') || 0;

  // Logout function
  function logout(){
    localStorage.removeItem('tv_user');
    localStorage.removeItem('tv_bal');
    alert("You have been logged out!");
    window.location.href = "login.html";
  }

  // ✅ PWA Install
  let deferredPrompt;
  const installBtn = document.getElementById('installBtn');
  installBtn.style.display = 'none';

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installBtn.style.display = 'block';
  });

  installBtn.addEventListener('click', async () => {
    if(deferredPrompt){
      deferredPrompt.prompt();
      const choiceResult = await deferredPrompt.userChoice;
      if(choiceResult.outcome === 'accepted'){
        alert('App installed successfully!');
      }
      deferredPrompt = null;
      installBtn.style.display = 'none';
    }
  });

  // ✅ Register Service Worker
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('sw.js')
      .then(() => console.log("Service Worker Registered"))
      .catch(err => console.log("SW registration failed:", err));
  }
</script>

</body>
</html>
